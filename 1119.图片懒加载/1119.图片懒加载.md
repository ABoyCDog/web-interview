# 图片懒加载

## 1、前言

&emsp;&emsp;图片懒加载用在一些图片密集型的网站中，通过图片懒加载可以让一些不可视的图片，或者说不在当前视窗里的图片暂不去加载，避免一次加载过多图片导致请求阻塞，特别是在弱网环境或网速较慢的情况下，非常影响体验。通过懒加载就可以提高网页加载速度，提高用户体验。

- Medium 的超棒浏览体验

  [medium.com](https://medium.com/) 是近几年崛起的一个英语写作平台(需要科学上网)。Medium 致力于提供一个专注于写作和阅读的平台。

  - 超棒的 UI？ 也就是超棒的图片懒加载？
  - 广告少，好阅读？
  - 软文少，不是为了买东西，而是传授知识

  其中使用到的几种技术：

  - 1、使用 `aspect ratio box` 创建占位元素。
  - 2、在 html 解析时只加载一个小尺寸的图片，并且添加 blur 效果
  - 3、最后使用 js 选择性的加载真实图片

## 普通做法
[掘金](https://juejin.cn/post/6844903688390049800#heading-3)
## 使用高级特性 `Intersection Observer` API

&emsp;&emsp;InterSection Observer 提供了一种异步监测目标元素与祖先元素或 viewport 视窗相交情况变化的方法。
过去要检测一个元素是否可见或者两个元素是否相交并不容易，很多解决办法不可靠或性能差。

> 如:相交元素检查要用到事件监听，并且需要频繁调用 `Element.getBoundingClientRect()` 方法以获取相关元素的边界信息。
>> 事件监听和调用Element.getBoundingClientRect()都是在主线程上运行，因此频繁触发调用会导致性能问题，所以这种方法检测并不优雅

> Intersection Observer API 会注册一个回调函数，每当被监视的元素进入或者退出另外一个元素时(或者 viewport )，或者两个元素的相交部分大小发生变化时，该回调方法会被触发执行。这样，我们网站的主线程不需要再为了监听元素相交而辛苦劳作，浏览器会自行优化元素相交管理。
>> 注意 Intersection Observer API 无法提供重叠的像素个数或者具体哪个像素重叠，他的更常见的使用方式是——当两个元素相交比例在 N% 左右时，触发回调，以执行某些逻辑。


## 总结

- 1、懒加载用户当前视窗的图片可以提升页面的加载性能
- 2、懒加载的思路是在 html 解析时先加载一个 placeholder 图片，最后再用 js 选择性的加载真实图片
- 3、如果需要滚动加载，可以使用 `InterSection Observer`的 API，是一个解决当前元素与祖先元素或 viewport 相交的问题的 API
- 4、对于固定尺寸个不固定尺寸的图片，我们可以选择不同的服务去获取 placeholder 图片
- 5、对于图片尺寸不确定引起的布局抖动问题，我们可以使用 `aspect ratio box` 来解决
